<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Login & Lock</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc, onSnapshot, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSy...",
            authDomain: "lotterymachine-by-mmd.firebaseapp.com",
            projectId: "lotterymachine-by-mmd",
            storageBucket: "lotterymachine-by-mmd.appspot.com",
            messagingSenderId: "977277760191",
            appId: "1:977277760191:web:f55cd69cc7b4ee91504c0a"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const lockRef = doc(db, "site_settings", "lockState");
        
        const encryptedPass = "MTIz"; // Base64 for "123"
        const encryptedUser = "TWl oaXI="; // Base64 for "Mihir"
        
        function decodeBase64(str) {
            return atob(str);
        }

        function checkIfLocked() {
            onSnapshot(lockRef, (docSnap) => {
                if (docSnap.exists()) {
                    const isLocked = docSnap.data().locked;
                    updateLockButton(isLocked);
                    document.getElementById("login-box").style.display = isLocked ? "none" : "block";
                }
            });
        }

        async function toggleLock() {
            const password = prompt("Enter Password:");
            if (password !== decodeBase64(encryptedPass)) {
                alert("Wrong password!");
                return;
            }
            
            const docSnap = await getDoc(lockRef);
            if (docSnap.exists()) {
                const isLocked = docSnap.data().locked;
                await updateDoc(lockRef, { locked: !isLocked });
                alert(isLocked ? "ðŸ”“ Site Unlocked!" : "ðŸ”’ Site Locked!");
            }
        }

        function updateLockButton(isLocked) {
            const lockButton = document.getElementById("lockButton");
            lockButton.textContent = isLocked ? "Inactive" : "Active";
            lockButton.style.backgroundColor = isLocked ? "orange" : "cyan";
        }

        function checkLogin() {
            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;
            if (username === decodeBase64(encryptedUser) && password === decodeBase64(encryptedPass)) {
                window.location.href = "main.html";
            } else {
                alert("Invalid credentials. Try again.");
            }
        }

        function preventNavigation() {
            history.pushState(null, null, location.href);
            window.onpopstate = function () {
                history.pushState(null, null, location.href);
            };
        }

        function disableSaveAndDownload() {
            document.addEventListener('contextmenu', event => event.preventDefault());
            document.addEventListener('keydown', function (event) {
                if (event.ctrlKey && (event.key === 's' || event.key === 'u' || event.key === 'p')) {
                    event.preventDefault();
                }
            });
        }

        function makePageUnreadable() {
            window.onbeforeunload = function () {
                document.body.innerHTML = "<h1>Content Unavailable</h1>";
            };
        }

        window.onload = () => {
            checkIfLocked();
            preventNavigation();
            disableSaveAndDownload();
            makePageUnreadable();
        };

        window.toggleLock = toggleLock;
        window.checkLogin = checkLogin;
    </script>
</head>
<body>
    <div id="login-box">
        <input type="text" id="username" placeholder="Username">
        <input type="password" id="password" placeholder="Password">
        <button onclick="checkLogin()">Login</button>
    </div>
    <button id="lockButton" onclick="toggleLock()">Active</button>
</body>
</html>
